syntax = "proto3";
import "google/protobuf/timestamp.proto";

package carrental;

service CarRentalService {
    // Admin operations
    rpc AddCar(AddCarRequest) returns (AddCarResponse);
    rpc UpdateCar(UpdateCarRequest) returns (OperationResponse);
    rpc RemoveCar(RemoveCarRequest) returns (OperationResponse);

    // Customer operations
    rpc ListAvailableCars(AvailableCarsRequest) returns (stream Car);
    rpc SearchCar(SearchCarRequest) returns (SearchCarResponse);
    rpc AddToCart(AddToCartRequest) returns (OperationResponse);
    rpc PlaceReservation(PlaceReservationRequest) returns (ReservationResponse);

    // User management
    rpc CreateUsers(stream User) returns (OperationResponse);
}

// ===== CORE DATA STRUCTURES =====
message Car {
    string plate_number = 1;
    string make = 2;
    string model = 3;
    int32 year = 4;
    float daily_price = 5;
    int32 mileage = 6;         
    CarStatus status = 7;
}

message User {
    string user_id = 1;        
    string name = 2;
    Role role = 3;
}

message CartItem {
    string plate_number = 1;
    google.protobobuf.Timestamp start_date = 2;
    google.protobuf.Timestamp end_date = 3;
}

// ===== REQUEST/RESPONSE MESSAGES =====
message AddCarRequest {
    Car car = 1;
}

message AddCarResponse {
    string plate_number = 1;
    string message = 2;
    bool success = 3;
}

message OperationResponse {     
    bool success = 1;
    string message = 2;
}

message UpdateCarRequest {
    string plate_number = 1;
    optional string make = 2;
    optional string model = 3;
    optional int32 year = 4;
    optional float daily_price = 5;
    optional int32 mileage = 6;
    optional CarStatus status = 7;
}

message RemoveCarRequest {
    string plate_number = 1;
}

message AvailableCarsRequest {
    optional string filter_make = 1;
    optional string filter_model = 2;
    optional int32 filter_year = 3;
    optional int32 max_results = 4;
}

message SearchCarRequest {
    string plate_number = 1;
}

message SearchCarResponse {
    oneof result {
        Car car = 1;
        string not_found_message = 2;
    }
}

message AddToCartRequest {
    string user_id = 1;
    CartItem cart_item = 2;
}

message PlaceReservationRequest {
    string user_id = 1;
}

message ReservationResponse {
    string reservation_id = 1;
    string message = 2;
    bool success = 3;
    float total_price = 4;
    repeated CartItem reserved_items = 5;
}

// ===== ENUMERATIONS =====
enum CarStatus {
    STATUS_UNSPECIFIED = 0;
    STATUS_AVAILABLE = 1;
    STATUS_UNAVAILABLE = 2;
    STATUS_RENTED = 3;          
    STATUS_MAINTENANCE = 4;     
}

enum Role {                     
    ROLE_UNSPECIFIED = 0;
    ROLE_CUSTOMER = 1;
    ROLE_ADMIN = 2;
}